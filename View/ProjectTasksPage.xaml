<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TaskManagerApp.View.ProjectTasksPage"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="10">

        <!-- Filter -->
        <Picker Title="Фильтр по статусу"
                Grid.Row="0"
                Margin="5"
                FontSize="14">
        </Picker>

        <!-- Tasks List -->
        <CollectionView ItemsSource="{Binding Tasks}"
                        Grid.Row="1"
                        SelectionMode="Single">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="15" 
                          RowDefinitions="Auto,Auto,Auto" 
                          ColumnDefinitions="*,Auto,Auto"
                          ColumnSpacing="10"
                          Margin="0,5">
                        
                        <Label Text="{Binding Title}"
                               FontSize="16"
                               FontAttributes="Bold"
                               Grid.Row="0"
                               Grid.Column="0"/>
                        
                        <Label Text="{Binding ., StringFormat='Приоритет: {0.Priority}'}"
                               FontSize="13"
                               Grid.Row="1"
                               Grid.Column="0"
                               TextColor="#666666"/>

                        <Label Text="{Binding ., StringFormat='Статус: {0.Status}'}"
                               FontSize="13"
                               Grid.Row="2"
                               Grid.Column="0"
                               TextColor="#666666"/>

                        <!-- Edit Button -->
                        <Button Text="✎ Редактировать"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditTaskCommand}"
                                CommandParameter="{Binding .}"
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Padding="8"
                                FontSize="12"
                                BackgroundColor="#2196F3"
                                TextColor="White"
                                CornerRadius="5"/>

                        <!-- Delete Button -->
                        <Button Text="✕"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteTaskCommand}"
                                CommandParameter="{Binding .}"
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="2"
                                Padding="8"
                                FontSize="12"
                                BackgroundColor="#FF5252"
                                TextColor="White"
                                CornerRadius="5"/>

                        <!-- Status Toggle -->
                        <Button Text="⟳ Изменить статус"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleTaskStatusCommand}"
                                CommandParameter="{Binding .}"
                                Grid.Row="2"
                                Grid.ColumnSpan="3"
                                Margin="0,5,0,0"
                                Padding="10"
                                FontSize="12"
                                BackgroundColor="#FF9800"
                                TextColor="White"
                                CornerRadius="5"/>

                        <BoxView Color="#E0E0E0"
                                 Grid.Row="3"
                                 Grid.ColumnSpan="3"
                                 HeightRequest="1"
                                 Margin="0,10,0,0"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Add Task Button -->
        <Button Text="+ Добавить задачу"
                Command="{Binding AddTaskCommand}"
                Grid.Row="2"
                Padding="15"
                Margin="5"
                FontSize="16"
                FontAttributes="Bold"
                BackgroundColor="#4CAF50"
                TextColor="White"
                CornerRadius="8"/>

    </Grid>

</ContentPage>
